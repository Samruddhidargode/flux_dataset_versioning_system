<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Version {{ info.version_hash[:12] }} — FLUX</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #0d1117; --surface: #161b22; --surface2: #21262d;
            --border: #30363d; --text: #e6edf3; --text-dim: #8b949e;
            --accent: #58a6ff; --green: #3fb950; --orange: #d29922;
            --red: #f85149; --purple: #bc8cff;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
        .navbar { background: var(--surface); border-bottom: 1px solid var(--border); padding: 12px 32px; display: flex; align-items: center; justify-content: space-between; }
        .navbar .logo { font-size: 20px; font-weight: 700; letter-spacing: 3px; color: var(--accent); }
        .navbar .logo span { color: var(--text-dim); font-weight: 400; font-size: 13px; letter-spacing: 0; margin-left: 12px; }
        .navbar nav a { color: var(--text-dim); text-decoration: none; margin-left: 24px; font-size: 14px; }
        .navbar nav a:hover { color: var(--accent); }
        .container { max-width: 1200px; margin: 0 auto; padding: 32px 24px; }

        .breadcrumb { font-size: 13px; color: var(--text-dim); margin-bottom: 24px; }
        .breadcrumb a { color: var(--accent); text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }

        .version-header { margin-bottom: 32px; }
        .version-header h1 {
            font-size: 24px; font-weight: 700; margin-bottom: 8px;
            font-family: 'SF Mono', 'Fira Code', monospace;
            color: var(--accent);
            word-break: break-all;
        }
        .tag-badge { display: inline-block; background: var(--green); color: var(--bg); font-size: 12px; font-weight: 600; padding: 3px 10px; border-radius: 12px; margin-right: 6px; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 32px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }

        .card { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 20px; }
        .card h3 { font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-dim); margin-bottom: 16px; }

        .info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border); }
        .info-row:last-child { border-bottom: none; }
        .info-row .label { color: var(--text-dim); font-size: 13px; }
        .info-row .value { font-weight: 600; font-size: 14px; }
        .info-row .mono { font-family: 'SF Mono', 'Fira Code', monospace; font-size: 12px; color: var(--accent); word-break: break-all; }

        /* Pipeline */
        .pipeline-steps { list-style: none; }
        .pipeline-step {
            display: flex; align-items: center; gap: 12px;
            padding: 10px 0; border-bottom: 1px solid var(--border);
        }
        .pipeline-step:last-child { border-bottom: none; }
        .step-num {
            width: 28px; height: 28px; border-radius: 50%;
            background: var(--purple); color: var(--bg);
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 700; flex-shrink: 0;
        }
        .step-name { font-weight: 600; }
        .step-params { font-size: 12px; color: var(--text-dim); font-family: 'SF Mono', monospace; }

        /* Config JSON */
        .config-block {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 16px;
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 13px;
            overflow-x: auto;
            white-space: pre;
            color: var(--text-dim);
            max-height: 300px;
            overflow-y: auto;
        }

        /* Data Table */
        .section-title { font-size: 18px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .section-title .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent); }
        .table-container { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; margin-bottom: 32px; }
        table { width: 100%; border-collapse: collapse; }
        thead { background: var(--surface2); }
        th { text-align: left; padding: 12px 16px; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-dim); border-bottom: 1px solid var(--border); }
        td { padding: 12px 16px; font-size: 14px; border-bottom: 1px solid var(--border); max-width: 500px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        tr:last-child td { border-bottom: none; }
        tr:hover { background: var(--surface2); }

        .footer { text-align: center; padding: 24px; color: var(--text-dim); font-size: 12px; border-top: 1px solid var(--border); margin-top: 48px; }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="logo">FLUX <span>Dataset Versioning Dashboard</span></div>
        <nav>
            <a href="/">Dashboard</a>
            <a href="/compare">Compare</a>
        </nav>
    </div>

    <div class="container">
        <div class="breadcrumb">
            <a href="/">Dashboard</a> &rarr; Version Detail
        </div>

        <div class="version-header">
            <h1>{{ info.version_hash }}</h1>
            <div>
                {% for tag in info.tags %}
                <span class="tag-badge">{{ tag }}</span>
                {% endfor %}
            </div>
        </div>

        <div class="grid">
            <!-- Metrics Card -->
            <div class="card">
                <h3>Metrics</h3>
                <div class="info-row">
                    <span class="label">Samples</span>
                    <span class="value">{{ info.metrics.get('num_samples', '-') }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Unique Texts</span>
                    <span class="value">{{ info.metrics.get('num_unique_texts', '-') }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Vocab Size</span>
                    <span class="value">{{ info.metrics.get('vocab_size', '-') }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Avg Text Length</span>
                    <span class="value">{{ "%.1f" | format(info.metrics.get('avg_text_length', 0)) }}</span>
                </div>
                {% if info.metrics.get('class_distribution') %}
                <div class="info-row">
                    <span class="label">Class Distribution</span>
                    <span class="value">
                        {% for cls, cnt in info.metrics['class_distribution'].items() %}
                        {{ cls }}: {{ cnt }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </span>
                </div>
                {% endif %}
                <div class="info-row">
                    <span class="label">Created</span>
                    <span class="value" style="font-size:12px;">{{ (info.metrics.get('created_at', '-') | string)[:19] }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Created By</span>
                    <span class="value">{{ info.metrics.get('created_by', '-') }}</span>
                </div>
            </div>

            <!-- Hashes Card -->
            <div class="card">
                <h3>Identity</h3>
                <div class="info-row">
                    <span class="label">Version Hash</span>
                    <span class="value mono">{{ info.version_hash }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Raw Data Hash</span>
                    <span class="value mono">{{ info.raw_hash }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Config Hash</span>
                    <span class="value mono">{{ info.config_hash }}</span>
                </div>

                <h3 style="margin-top: 20px;">Preprocessing Pipeline</h3>
                {% if pipeline %}
                <ul class="pipeline-steps">
                    {% for step in pipeline %}
                    <li class="pipeline-step">
                        <div class="step-num">{{ loop.index }}</div>
                        <div>
                            <div class="step-name">{{ step.step }}</div>
                            {% if step.get('params') %}
                            <div class="step-params">{{ step.params }}</div>
                            {% endif %}
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p style="color: var(--text-dim); padding: 8px 0;">No preprocessing (raw data)</p>
                {% endif %}
            </div>
        </div>

        <!-- Config JSON -->
        <div class="section-title"><div class="dot" style="background: var(--purple);"></div> Full Config</div>
        <div class="card" style="margin-bottom: 32px;">
            <div class="config-block">{{ pipeline_json }}</div>
        </div>

        <!-- Data Preview -->
        <div class="section-title"><div class="dot"></div> Data Preview ({{ total_rows }} total rows, showing first {{ preview | length }})</div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        {% for col in columns %}
                        <th>{{ col }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in preview %}
                    <tr>
                        <td style="color: var(--text-dim);">{{ loop.index }}</td>
                        {% for col in columns %}
                        <td title="{{ row[col] }}">{{ (row[col] | string)[:100] }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="footer">
        FLUX — File-based Lightweight Universal Xplainable Dataset Versioning System
    </div>
</body>
</html>
